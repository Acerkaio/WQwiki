# 凸性相关
```
定义：
	凸包：平面上包含所有点的最小多边形
	上凸壳、下凸壳：凸包的上下两部分
	离散函数的凸性：函数图像是个凸壳
凸包性质：
	上下凸壳的边具有斜率单调性
	任意两点的连线上的所有点都不在凸包外
	任意一条经过某个点、斜率固定的直线要斜率最大（小），其必经过凸包上的点
		进一步的，其斜率必然在其邻边范围内（针对凸壳而言）
函数凸性性质：
	对于满足四边形不等式的序列划分问题，其答案关于段数必然有凸性
	凸性函数做前缀max/min仍然有凸性
		例如，若恰好有凸性，那么至少一定有凸性，但反之并不一定（虽然没见过实际反例）
	费用流中最小费用关于流量有凸性
		若要钦定某物必选，那么就将其费用设成-inf即可，亦可证明凸性
联想点：
	当题目出现了比值、乘积（实数意义上）等形式时，就要联想到凸包
	通常可以解决一些非常特殊的最优化问题

建立凸包：
	下面考虑建立凸壳
	线性扫描法（离线做法）：
		将点按照横坐标排序，然后增量法构造凸包
		假设现在已经构造好i-1的凸包，加入点i，考虑凸包形态变化
		根据凸包定义，我们将末尾的、凹进去的点删掉，容易得到剩下的还是凸包
	插入法（在线凸包）：
		每次插入一个点，就找到其横坐标被凸包的哪条边跨过
		加入当前点不优，那直接结束
		否则，将左右两边凹进去的点删掉
		正确性类似上述做法
旋转卡壳：
	常见用途：求解平面最远点对
	引理：任何一个点的最远点一定在凸包上
	流程：
		基于凸包的边的单调性，我们顺时针枚举边，然后考虑其对应的最远点
		显然，最远点也是顺时针转动的
		每次更新边两端点和最远点作为答案
		
		显然，任何一个不劣解都被考虑到了

闵科夫斯基和：
	定义：任意两个图形内的点加起来组成的新图形
	基本结论：两个凸包的闵可夫斯基和还是一个凸包
	
	常见用途：凸包合并，{max,+}卷积
	下面主要考虑凸壳的合并
	
	流程：
		每次将两个凸壳的边拿出来，根据斜率贪心，做归并排序即可
		新凸壳的起始点是原凸壳起始点之和
	
	感性理解：
		因为为了让凸包尽可能大，才能把所有能产生的点都包括进来
	对{max,+}卷积的理解：
		可以将两个多项式看成两个点集
		对于一个固定的横坐标，其卷积就是所有满足横坐标和等于该坐标的点的纵坐标和的max
		这恰好就是闵可夫斯基和的定义

wqs二分：
	常见用途：给定x，求解凸函数f的某个f(x)的值
	流程：
		二分斜率k，考虑斜率为k的直线的切点的横坐标
		根据凸性，横坐标关于k有单调性
		那么核心在于求切点，就是求f(x)-k*x最大的点的横坐标x
	细节：
		二分的值域：
			需要分析凸壳上的边的斜率的值域范围
			通常只要考虑凸壳上第一条边和最后一条边即可
		二分的是整数还是实数？
			首先，如果是离散凸函数，那么每一条边的斜率都是整数
			但是，注意到会有共线的点，所以可能有问题
			这里不建议二分实数，还是应二分整数
			为了处理共线的情况，应当钦定x最大或最小，从而可以二分判定
		构造解：
			朴素的wqs二分可以容易地得到f(x)，但是求解会受到共线的影响
			
			待填，暂时不太会，网上也没有非常正确的

wqs二分和闵可夫斯基和的联系：
	对于一个确定斜率的直线，两个凸壳的切点对应的截距和 恰等于
		两个凸壳做闵可夫斯基和之后的凸壳的切点的截距
	这启示我们，wqs二分和闵可夫斯基和是有具体联系的
	
	这主要是因为具有凸性的问题通常都可以被划分成若干子问题，最后合并子问题的解
	而如果用闵可夫斯基和就是在维护所有情况的解（凸壳），而wqs二分是维护一个特解（点）
	
	有时，我们可以预处理出闵可夫斯基和的结果，再结合wqs二分解决一些多次询问问题

斜率优化：
	核心：
		分析凸包形态，考虑最优点怎么取
		具体做法：
			dp式应该形如dp[i]=max(dp[j]+A+B*i*j)
			而注意到经过点(x,y)的斜率为k的直线的截距是y-kx
			所以钦定每个点形如(j,dp[j]+A)
			我们要找斜率为-B的经过某个点的直线的最大截距
			因此必然保留的是个上凸包
	常见算法：
		一般来说，非在线转移就算是离线问题
		在线转移需要同时维护插入直线和查询最优点
		建立凸包：
			在线且横坐标没有单调性：李超线段树
			否则：直接线性建凸包
		找最优点：
			在线且查询斜率没有单调性：二分凸包或李超线段树上直接查
			否则：指针直接扫
			
例题：
[ABC356G] Freestyle ：
	判定可行性是简单的，重点在处理最优性
	贪心和DP都不太能冲，没什么突破口
	流也不太行
	我们假设只用了两种style，那么将式子列出来
	那个不超过C很蠢，在实数意义下，这很大概率可以取等
	可以发现这就是向量的等和线
	那么我们就要让整体尽量取小，所以求凸包，在上面二分即可
[JOISC2022] 京都观光 ：
	直接做不太可做
	将拐点的式子写一下，可以发现是凸包

```